<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RetroQuiz 70s</title>
    
    <!-- BIBLIOTECAS -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;700&family=Shrikhand&display=swap" rel="stylesheet">

    <style>
        :root {
            --cor-laranja: #dc5128;
            --cor-verde: #a2cebb;
            --cor-creme: #fdfbf7;
            --cor-preto: #1a1a1a;
            --cor-amarelo: #f4d03f;
        }

        body {
            background-color: var(--cor-creme);
            background-image:  radial-gradient(rgba(220, 81, 40, 0.08) 2px, transparent 2px), radial-gradient(rgba(220, 81, 40, 0.08) 2px, transparent 2px);
            background-size: 30px 30px;
            background-position: 0 0, 15px 15px;
            font-family: 'DM Sans', sans-serif;
            color: var(--cor-preto);
            overflow-x: hidden;
            min-height: 100vh;
        }

        .font-retro { font-family: 'Shrikhand', cursive; letter-spacing: 1px; }

        .hard-shadow {
            box-shadow: 4px 4px 0px 0px var(--cor-preto);
            transition: all 0.2s ease;
            border: 3px solid var(--cor-preto);
        }
        
        .hard-shadow:active:not(:disabled) {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0px 0px var(--cor-preto);
        }
        
        .hard-shadow:disabled { opacity: 0.6; cursor: not-allowed; box-shadow: none; }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-slide-in { animation: slideIn 0.5s ease-out forwards; }

        /* Estilos especﾃｭficos para o Login */
        .login-input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 3px solid var(--cor-preto);
            border-radius: 8px;
            font-size: 1rem;
            outline: none;
        }
        .login-input:focus {
            border-color: var(--cor-laranja);
            background-color: #fff8f0;
        }

        /* Menu Hamburguer */
        .menu-dropdown {
            transform-origin: top right;
            animation: scaleIn 0.2s ease-out forwards;
        }
        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // =================================================================
        // 泊 CONFIGURAﾃﾃグ DA API & DADOS
        // =================================================================
        const PART_A = "sk-proj-Wuj2j8kDamPxvALe8xWXhvxMMwsWxUwftwzkmeL1ylnGzYPMdU1QYAO1B1Wpxyn"; 
        const PART_B = "QLrQfDGcIMOT3BlbkFJM5YNmkMRwdetW1loy5AYAhEfO6pQb0iJCbBJiTw0Wh3O5tQg-cAWmeu7VisSbjIQ6zu4HAsx4A"; 
        const API_KEY = PART_A + PART_B; 
        const MAX_IMAGES = 3; 

        // Funﾃｧﾃ｣o para embaralhar arrays (Fisher-Yates Shuffle)
        const shuffleArray = (array) => {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        };

        // -----------------------------------------------------------------
        // 答 BANCO DE DADOS OFFLINE (Temas Prﾃｩ-definidos)
        // -----------------------------------------------------------------
        const OFFLINE_DB = {
            "Cinema": {
                easy: [
                    { text: "Qual filme tem um ogro verde como protagonista?", options: ["Shrek", "Hulk", "Grinch", "Yoda"], answer: "Shrek", points: 10 },
                    { text: "Quem ﾃｩ o vilﾃ｣o de Star Wars que usa armadura preta?", options: ["Darth Vader", "Voldemort", "Coringa", "Thanos"], answer: "Darth Vader", points: 10 },
                    { text: "Qual animal ﾃｩ o Rei Leﾃ｣o?", options: ["Leﾃ｣o", "Tigre", "Urso", "Lobo"], answer: "Leﾃ｣o", points: 10 },
                    { text: "Em 'Titanic', o que causa o naufrﾃ｡gio?", options: ["Iceberg", "Baleia", "Torpedo", "Tempestade"], answer: "Iceberg", points: 10 },
                    { text: "Qual brinquedo ganha vida em Toy Story?", options: ["Todos os brinquedos", "Apenas o Woody", "Nenhum", "Bonecas apenas"], answer: "Todos os brinquedos", points: 10 }
                ],
                medium: [
                    { text: "Quem dirigiu 'Parque dos Dinossauros' (1993)?", options: ["Steven Spielberg", "George Lucas", "James Cameron", "Tarantino"], answer: "Steven Spielberg", points: 20 },
                    { text: "Qual a pﾃｭlula que Neo toma em Matrix?", options: ["Vermelha", "Azul", "Verde", "Amarela"], answer: "Vermelha", points: 20 },
                    { text: "Em 'O Senhor dos Anﾃｩis', quantos anﾃｩis foram dados aos Anﾃｵes?", options: ["7", "3", "9", "1"], answer: "7", points: 20 },
                    { text: "Qual o nome da cidade fictﾃｭcia do Batman?", options: ["Gotham", "Metropolis", "Star City", "Smallville"], answer: "Gotham", points: 20 },
                    { text: "Quem interpretou o Coringa em 'O Cavaleiro das Trevas'?", options: ["Heath Ledger", "Joaquin Phoenix", "Jared Leto", "Jack Nicholson"], answer: "Heath Ledger", points: 20 }
                ],
                hard: [
                    { text: "Qual foi o primeiro filme a ganhar o Oscar de Melhor Filme?", options: ["Wings", "Sunrise", "Metropolis", "The Jazz Singer"], answer: "Wings", points: 30 },
                    { text: "Em 'Pulp Fiction', o que tem dentro da maleta?", options: ["Nunca ﾃｩ revelado", "Ouro", "Diamantes", "A alma do Marsellus"], answer: "Nunca ﾃｩ revelado", points: 30 },
                    { text: "Qual o nome do robﾃｴ em 'Interstellar'?", options: ["TARS", "HAL", "R2-D2", "Ava"], answer: "TARS", points: 30 },
                    { text: "Quem compﾃｴs a trilha sonora de 'O Bom, o Mau e o Feio'?", options: ["Ennio Morricone", "Hans Zimmer", "John Williams", "Vangelis"], answer: "Ennio Morricone", points: 30 },
                    { text: "Em que ano estreou 'O Poderoso Chefﾃ｣o'?", options: ["1972", "1974", "1969", "1970"], answer: "1972", points: 30 }
                ]
            },
            "Ciﾃｪncias": {
                easy: [
                    { text: "Qual planeta ﾃｩ conhecido como Planeta Vermelho?", options: ["Marte", "Jﾃｺpiter", "Vﾃｪnus", "Saturno"], answer: "Marte", points: 10 },
                    { text: "O que as plantas usam para fazer fotossﾃｭntese?", options: ["Luz solar", "Fogo", "Vento", "Areia"], answer: "Luz solar", points: 10 },
                    { text: "Qual ﾃｩ a fﾃｳrmula da ﾃ｡gua?", options: ["H2O", "CO2", "O2", "H2SO4"], answer: "H2O", points: 10 },
                    { text: "Quantas pernas tem uma aranha?", options: ["8", "6", "4", "10"], answer: "8", points: 10 },
                    { text: "Qual ﾃｳrgﾃ｣o bombeia sangue no corpo?", options: ["Coraﾃｧﾃ｣o", "Fﾃｭgado", "Pulmﾃ｣o", "Estﾃｴmago"], answer: "Coraﾃｧﾃ｣o", points: 10 }
                ],
                medium: [
                    { text: "Qual ﾃｩ o metal lﾃｭquido ﾃ temperatura ambiente?", options: ["Mercﾃｺrio", "Ferro", "Chumbo", "Alumﾃｭnio"], answer: "Mercﾃｺrio", points: 20 },
                    { text: "Quem propﾃｴs a Teoria da Relatividade?", options: ["Einstein", "Newton", "Tesla", "Darwin"], answer: "Einstein", points: 20 },
                    { text: "Qual o sﾃｭmbolo quﾃｭmico do Ouro?", options: ["Au", "Ag", "Fe", "Cu"], answer: "Au", points: 20 },
                    { text: "Qual a velocidade da luz (aprox)?", options: ["300.000 km/s", "150.000 km/s", "1.000 km/s", "Som"], answer: "300.000 km/s", points: 20 },
                    { text: "O que ﾃｩ o DNA?", options: ["ﾃ…ido Desoxirribonucleico", "ﾃ…ido Ribonucleico", "Proteﾃｭna", "Gordura"], answer: "ﾃ…ido Desoxirribonucleico", points: 20 }
                ],
                hard: [
                    { text: "Qual partﾃｭcula ﾃｩ conhecida como 'Partﾃｭcula de Deus'?", options: ["Bﾃｳson de Higgs", "Quark", "Neutrino", "Fﾃｳton"], answer: "Bﾃｳson de Higgs", points: 30 },
                    { text: "Quem descobriu a Penicilina?", options: ["Fleming", "Pasteur", "Curie", "Darwin"], answer: "Fleming", points: 30 },
                    { text: "Qual ﾃｩ a estrela mais prﾃｳxima da Terra depois do Sol?", options: ["Proxima Centauri", "Sirius", "Alpha Centauri A", "Betelgeuse"], answer: "Proxima Centauri", points: 30 },
                    { text: "O que mede a escala de Mohs?", options: ["Dureza dos minerais", "Terremotos", "Ventos", "Acidez"], answer: "Dureza dos minerais", points: 30 },
                    { text: "Qual o nome da primeira ovelha clonada?", options: ["Dolly", "Molly", "Polly", "Holly"], answer: "Dolly", points: 30 }
                ]
            }
        };

        // --- SERVIﾃ⑯ DE API ---
        const fetchAllQuestionsFromGPT = async (theme) => {
            let dataToProcess = null;

            // 1. Tenta pegar do banco Offline
            if (OFFLINE_DB[theme]) {
                console.log("Usando banco offline para:", theme);
                await new Promise(r => setTimeout(r, 800)); // Pequeno delay para UX
                dataToProcess = JSON.parse(JSON.stringify(OFFLINE_DB[theme])); // Deep copy
            } 
            
            // 2. Se nﾃ｣o, tenta a API
            if (!dataToProcess && API_KEY) {
                const prompt = `
                    Topic: "${theme}".
                    Generate a COMPLETE QUIZ with 15 UNIQUE multiple-choice questions divided into 3 levels:
                    - 5 Easy
                    - 5 Medium
                    - 5 Hard
                    Target Audience Language: Brazilian Portuguese (pt-BR).
                    Strict Output Rules:
                    1. JSON object only.
                    2. Structure: { "easy": [...], "medium": [...], "hard": [...] }
                    3. { "text": "...", "options": ["...", "...", "...", "..."], "answer": "..." }
                    4. No repeated questions.
                `;

                try {
                    const response = await fetch("https://api.openai.com/v1/chat/completions", {
                        method: "POST",
                        headers: { "Content-Type": "application/json", "Authorization": `Bearer ${API_KEY}` },
                        body: JSON.stringify({
                            model: "gpt-4o",
                            messages: [{ role: "user", content: prompt }],
                            temperature: 0.7
                        })
                    });

                    const data = await response.json();
                    if (data.error) return { error: "Erro na API: " + data.error.message };

                    let content = data.choices[0].message.content.replace(/```json/g, '').replace(/```/g, '').trim();
                    dataToProcess = JSON.parse(content);
                    
                    // Add points
                    dataToProcess.easy = dataToProcess.easy.map(q => ({...q, points: 10}));
                    dataToProcess.medium = dataToProcess.medium.map(q => ({...q, points: 20}));
                    dataToProcess.hard = dataToProcess.hard.map(q => ({...q, points: 30}));

                } catch (error) {
                    console.error("Erro API:", error);
                    return { error: "Falha na conexﾃ｣o. Tente um tema offline." };
                }
            }

            // 3. Processamento Final (Randomizaﾃｧﾃ｣o)
            if (dataToProcess) {
                // Randomiza as opﾃｧﾃｵes de todas as perguntas para evitar que 'A' seja sempre a correta
                ['easy', 'medium', 'hard'].forEach(lvl => {
                    if(dataToProcess[lvl]) {
                        dataToProcess[lvl] = dataToProcess[lvl].map(q => ({
                            ...q,
                            options: shuffleArray(q.options)
                        }));
                    }
                });
                return dataToProcess;
            }

            return { error: "Nﾃ｣o foi possﾃｭvel carregar as perguntas." };
        };

        // --- COMPONENTES UI ---

        const Button = ({ children, onClick, variant = 'primary', className = '', disabled = false }) => {
            const colors = {
                primary: 'bg-[#dc5128] text-white',
                secondary: 'bg-[#a2cebb] text-black',
                yellow: 'bg-[#f4d03f] text-black',
                white: 'bg-white text-black',
                red: 'bg-red-500 text-white',
                outline: 'bg-transparent border-2 border-black hover:bg-black/5'
            };
            return (
                <button 
                    onClick={onClick} disabled={disabled}
                    className={`hard-shadow rounded-lg px-6 py-3 font-bold text-lg flex items-center justify-center gap-2 ${colors[variant]} ${className}`}
                >
                    {children}
                </button>
            );
        };

        const RetroImage = ({ src, className }) => {
            const [error, setError] = useState(false);
            if (error) return null; 
            return <img src={src} className={className} onError={() => setError(true)} />;
        };

        const HamburgerMenu = ({ onLoginClick, isLoggedIn }) => {
            const [isOpen, setIsOpen] = useState(false);
            const menuRef = useRef(null);

            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (menuRef.current && !menuRef.current.contains(event.target)) {
                        setIsOpen(false);
                    }
                };
                document.addEventListener("mousedown", handleClickOutside);
                return () => document.removeEventListener("mousedown", handleClickOutside);
            }, []);

            return (
                <div className="absolute top-4 right-4 z-50" ref={menuRef}>
                    <button 
                        onClick={() => setIsOpen(!isOpen)} 
                        className="bg-white p-2 rounded-lg border-2 border-black hard-shadow hover:bg-gray-50 transition-colors"
                    >
                        <i data-lucide="menu" className="w-8 h-8 text-[#1a1a1a]"></i>
                    </button>

                    {isOpen && (
                        <div className="absolute right-0 mt-2 w-56 bg-white border-2 border-black hard-shadow rounded-lg overflow-hidden menu-dropdown flex flex-col p-1">
                            {!isLoggedIn ? (
                                <button 
                                    onClick={() => { setIsOpen(false); onLoginClick(); }}
                                    className="text-left px-4 py-3 hover:bg-[#f4d03f] font-bold text-[#1a1a1a] flex items-center gap-2 rounded transition-colors"
                                >
                                    <i data-lucide="lock" size={18}></i>
                                    Login
                                </button>
                            ) : (
                                <div className="px-4 py-3 bg-green-100 text-green-800 font-bold text-sm text-center rounded">
                                    <i data-lucide="user-check" size={16} className="inline mr-1"></i>
                                    Logado
                                </div>
                            )}
                            
                            <a 
                                href="https://rickalisson.github.io/about-us.html" 
                                className="text-left px-4 py-3 hover:bg-[#a2cebb] font-bold text-[#1a1a1a] flex items-center gap-2 rounded transition-colors"
                            >
                                <i data-lucide="info" size={18}></i>
                                Sobre Nﾃｳs
                            </a>
                        </div>
                    )}
                </div>
            );
        };

        // --- TELAS ---

        const LoginScreen = ({ onLoginSuccess, onCancel }) => {
            const [email, setEmail] = useState("");
            const [password, setPassword] = useState("");
            const [error, setError] = useState("");

            const handleLogin = () => {
                if (email === "rickalissonpaz@gmail.com" && password === "12345678") {
                    onLoginSuccess();
                } else {
                    setError("Credenciais invﾃ｡lidas.");
                }
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-4 bg-black/50 fixed inset-0 z-50 animate-fade-in backdrop-blur-sm">
                    <div className="bg-white hard-shadow p-8 rounded-2xl max-w-md w-full border-4 border-black relative">
                        <button onClick={onCancel} className="absolute top-4 right-4 text-gray-500 hover:text-black">
                            <i data-lucide="x"></i>
                        </button>
                        
                        <div className="text-center mb-6">
                            <h1 className="font-retro text-4xl text-[#dc5128]">Login</h1>
                            <p className="font-bold text-gray-500 text-sm">Insira suas credenciais</p>
                        </div>
                        
                        <div className="space-y-4">
                            <div>
                                <label className="block font-bold mb-1">E-mail</label>
                                <input 
                                    type="email" 
                                    className="login-input" 
                                    placeholder="seu@email.com"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                />
                            </div>
                            <div>
                                <label className="block font-bold mb-1">Senha</label>
                                <input 
                                    type="password" 
                                    className="login-input" 
                                    placeholder="窶｢窶｢窶｢窶｢窶｢窶｢窶｢窶｢"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                />
                            </div>
                            
                            {error && (
                                <div className="bg-red-100 border-2 border-red-500 text-red-700 p-3 rounded mb-4 font-bold text-sm">
                                    {error}
                                </div>
                            )}

                            <Button onClick={handleLogin} className="w-full">Entrar</Button>
                        </div>
                    </div>
                </div>
            );
        };

        const StartScreen = ({ onStart, loading }) => {
            const [theme, setTheme] = useState("");
            const presets = ["Cinema", "Ciﾃｪncias", "Anos 80", "Histﾃｳria"];

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-4 relative animate-slide-in overflow-hidden">
                    <RetroImage src="assets/images/red/1.png" className="absolute left-4 top-1/4 w-32 md:w-48 hidden md:block opacity-80" />
                    <RetroImage src="assets/images/red/2.png" className="absolute right-4 bottom-1/4 w-32 md:w-48 hidden md:block opacity-80" />

                    <div className="text-center mb-10 w-full max-w-4xl relative z-10 pt-16 md:pt-0">
                        <img src="assets/images/RetroLogoOrange.PNG" alt="RetroQuiz" className="w-full max-w-3xl mx-auto mb-4" onError={(e) => {e.target.style.display='none'; document.getElementById('txt-logo').style.display='block'}} />
                        <h1 id="txt-logo" className="font-retro text-8xl md:text-9xl text-[#dc5128] hidden drop-shadow-[4px_4px_0_black]">RetroQuiz</h1>
                        <div className="bg-[#a2cebb] border-2 border-black inline-block px-4 py-2 text-xl -rotate-2 font-bold shadow-[3px_3px_0_0_black]">Ediﾃｧﾃ｣o Premium</div>
                    </div>

                    {loading ? (
                        <div className="bg-white p-10 rounded-2xl border-2 border-black hard-shadow flex flex-col items-center z-10">
                            <div className="animate-spin rounded-full h-12 w-12 border-b-4 border-[#dc5128] mb-4"></div>
                            <h2 className="font-retro text-2xl text-[#dc5128]">Preparando Perguntas...</h2>
                            <p className="font-bold text-gray-500">Criando desafios ﾃｺnicos para vocﾃｪ.</p>
                        </div>
                    ) : (
                        <div className="bg-white p-6 rounded-2xl border-2 border-black relative z-10 hard-shadow w-full max-w-lg">
                            <h2 className="text-2xl text-center mb-6 font-bold">Escolha um tema ou digite o seu:</h2>
                            
                            <div className="grid grid-cols-2 gap-3 mb-6">
                                {presets.map(p => (
                                    <button 
                                        key={p} 
                                        onClick={() => onStart(p)}
                                        className={`font-bold py-2 border-2 border-black rounded-lg hover:bg-[#f4d03f] transition-colors ${OFFLINE_DB[p] ? 'bg-green-50' : 'bg-gray-50'}`}
                                    >
                                        {p} {OFFLINE_DB[p] && <span className="text-[10px] bg-green-200 px-1 rounded ml-1 border border-green-600">OFF</span>}
                                    </button>
                                ))}
                            </div>

                            <div className="relative flex items-center mb-2">
                                <div className="flex-grow border-t border-gray-300"></div>
                                <span className="flex-shrink-0 mx-4 text-gray-400 font-bold text-sm">OU DIGITE</span>
                                <div className="flex-grow border-t border-gray-300"></div>
                            </div>

                            <div className="flex w-full gap-2">
                                <input type="text" value={theme} onChange={(e) => setTheme(e.target.value)} onKeyPress={(e) => e.key === 'Enter' && theme.trim() && onStart(theme)} placeholder="Qualquer assunto..." className="flex-1 p-4 text-xl border-3 border-black rounded-xl outline-none focus:ring-4 ring-[#a2cebb]" />
                                <Button onClick={() => theme.trim() && onStart(theme)} disabled={!theme.trim()}><i data-lucide="arrow-right"></i></Button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const MenuScreen = ({ theme, onSelectLevel, onBack }) => (
            <div className="min-h-screen flex flex-col p-6 max-w-5xl mx-auto animate-slide-in pt-20">
                <button onClick={onBack} className="self-start flex items-center font-bold hover:underline mb-8 text-lg"><i data-lucide="arrow-left" className="mr-2"></i> Voltar</button>
                <div className="text-center mb-10">
                    <p className="text-gray-500 uppercase tracking-widest text-sm font-bold">Tema Escolhido</p>
                    <h1 className="font-retro text-5xl md:text-6xl text-[#dc5128]">{theme}</h1>
                </div>
                <div className="grid md:grid-cols-3 gap-6">
                    {[
                        { id: 'easy', title: 'Fﾃ｡cil', color: 'bg-[#a2cebb]', desc: 'Aquecimento' },
                        { id: 'medium', title: 'Mﾃｩdio', color: 'bg-[#f4d03f]', desc: 'O Desafio' },
                        { id: 'hard', title: 'Difﾃｭcil', color: 'bg-[#dc5128] text-white', desc: 'Expert' }
                    ].map(lvl => (
                        <div key={lvl.id} onClick={() => onSelectLevel(lvl.id)} className={`${lvl.color} p-8 rounded-xl hard-shadow cursor-pointer hover:-translate-y-2 transition-all flex flex-col justify-between min-h-[200px]`}>
                            <div><h2 className="font-retro text-3xl mb-2">{lvl.title}</h2><p className="font-bold text-lg opacity-90">{lvl.desc}</p></div>
                            <div className="self-end mt-4"><i data-lucide="play-circle" size={40}></i></div>
                        </div>
                    ))}
                </div>
            </div>
        );

        const QuizScreen = ({ theme, level, questions, onFinish, onAbort }) => {
            const [currentIndex, setCurrentIndex] = useState(0);
            const [score, setScore] = useState(0);
            const [selectedOption, setSelectedOption] = useState(null);
            const [isConfirmed, setIsConfirmed] = useState(false);
            
            const decoration = useMemo(() => {
                const r1 = Math.floor(Math.random() * MAX_IMAGES) + 1;
                let r2 = Math.floor(Math.random() * MAX_IMAGES) + 1;
                if (r1 === r2) r2 = (r1 % MAX_IMAGES) + 1;
                return { left: `assets/${level}/${r1}.png`, right: `assets/${level}/${r2}.png` };
            }, [level]);

            const handleConfirm = () => {
                setIsConfirmed(true);
                const currentQ = questions[currentIndex];
                const correct = currentQ.answer === selectedOption;
                
                if (correct) {
                    setScore(s => s + currentQ.points);
                    confetti({ particleCount: 30, spread: 50, origin: { y: 0.8 } });
                }

                setTimeout(() => {
                    if (currentIndex < questions.length - 1) {
                        setCurrentIndex(p => p + 1);
                        setSelectedOption(null);
                        setIsConfirmed(false);
                    } else {
                        onFinish(correct ? score + currentQ.points : score, level);
                    }
                }, 1500);
            };

            const currentQ = questions[currentIndex];
            const progress = ((currentIndex) / questions.length) * 100;

            return (
                <div className="min-h-screen flex flex-col relative overflow-hidden animate-slide-in">
                    <RetroImage src={decoration.left} className="absolute left-4 bottom-4 w-32 md:w-40 opacity-70 pointer-events-none hidden md:block" />
                    <RetroImage src={decoration.right} className="absolute right-4 top-20 w-32 md:w-40 opacity-70 pointer-events-none hidden md:block" />

                    <div className="p-4 flex justify-between items-center bg-white border-b-4 border-black z-10">
                        <div className="flex items-center gap-4">
                            <button onClick={onAbort} className="bg-red-100 hover:bg-red-200 p-2 rounded-lg border-2 border-black transition-colors" title="Sair para Menu">
                                <i data-lucide="x" className="text-red-600"></i>
                            </button>
                            <span className="font-bold text-lg">Questﾃ｣o {currentIndex + 1}/{questions.length}</span>
                        </div>
                        <span className="font-retro text-2xl text-[#dc5128]">{score} pts</span>
                    </div>

                    <div className="h-4 bg-gray-200 w-full border-b-4 border-black">
                        <div className="h-full bg-[#a2cebb] transition-all duration-500 ease-out" style={{ width: `${progress}%` }}></div>
                    </div>

                    <div className="flex-1 flex flex-col items-center justify-center p-6 max-w-3xl mx-auto w-full z-10">
                        <div className="bg-white border-4 border-black p-8 rounded-xl w-full mb-6 text-center hard-shadow">
                            <h2 className="text-2xl font-bold leading-tight">{currentQ.text}</h2>
                        </div>
                        <div className="grid gap-3 w-full">
                            {currentQ.options.map((opt, idx) => {
                                let btnStyle = "bg-white hover:bg-gray-100";
                                if (isConfirmed) {
                                    if (opt === currentQ.answer) btnStyle = "bg-[#a2cebb] ring-4 ring-black"; 
                                    else if (opt === selectedOption) btnStyle = "bg-[#dc5128] text-white";
                                } else if (selectedOption === opt) {
                                    btnStyle = "bg-[#f4d03f] ring-4 ring-black";
                                }
                                return (
                                    <button key={idx} onClick={() => !isConfirmed && setSelectedOption(opt)} disabled={isConfirmed} className={`w-full p-4 text-lg font-bold border-3 border-black rounded-lg text-left transition-all flex items-center ${btnStyle}`}>
                                        <span className="w-8 h-8 flex items-center justify-center bg-gray-100 border-2 border-black rounded-full mr-3 text-sm flex-shrink-0">{String.fromCharCode(65 + idx)}</span>
                                        {opt}
                                    </button>
                                );
                            })}
                        </div>
                        <div className="mt-8 w-full md:w-auto">
                            <Button onClick={handleConfirm} disabled={!selectedOption || isConfirmed} className="w-full md:min-w-[200px]">
                                {isConfirmed ? "Verificando..." : "Confirmar"}
                            </Button>
                        </div>
                    </div>
                </div>
            );
        };

        const ResultScreen = ({ score, level, totalScore, onRestart, onNextLevel, onMenu }) => {
            const passed = score >= 30; // 30 points to pass
            const nextLevelId = (level === 'easy') ? 'medium' : (level === 'medium' ? 'hard' : null);

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-4 text-center animate-slide-in">
                    <div className="bg-white hard-shadow p-8 rounded-2xl max-w-lg w-full relative border-4 border-black">
                        <h2 className="text-gray-500 uppercase tracking-widest font-bold mb-2 text-sm">Resultado: {level}</h2>
                        <h1 className="font-retro text-6xl text-[#dc5128] mb-4">{score >= 30 ? "Mandou Bem!" : "Tente de novo"}</h1>
                        <div className="bg-[#fdfbf7] border-3 border-black p-6 rounded-xl mb-6 inline-block w-full">
                            <p className="text-sm font-bold uppercase text-gray-500 mb-2">Pontos da Fase</p>
                            <p className="font-retro text-7xl text-[#1a1a1a] leading-none">{score}</p>
                            <p className="text-lg font-bold mt-2 text-gray-600">Total Acumulado: {totalScore}</p>
                        </div>
                        <div className="flex flex-col gap-3">
                            {passed && nextLevelId && (
                                <Button onClick={() => onNextLevel(nextLevelId)} variant="secondary" className="w-full">
                                    Jogar Prﾃｳximo Nﾃｭvel <i data-lucide="arrow-right"></i>
                                </Button>
                            )}
                            <Button onClick={onMenu} variant="white" className="w-full">
                                <i data-lucide="list"></i> Voltar ao Menu de Nﾃｭveis
                            </Button>
                            <Button onClick={onRestart} variant="white" className="w-full text-sm">
                                <i data-lucide="rotate-ccw"></i> Escolher Outro Tema
                            </Button>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [isLoggedIn, setIsLoggedIn] = useState(false); // Admin status check
            const [showLoginModal, setShowLoginModal] = useState(false);
            const [screen, setScreen] = useState('start'); 
            
            const [theme, setTheme] = useState('');
            const [loadingQuestions, setLoadingQuestions] = useState(false);
            const [allQuestions, setAllQuestions] = useState({ easy: [], medium: [], hard: [] });
            const [level, setLevel] = useState('easy');
            const [score, setScore] = useState(0);
            const [totalScore, setTotalScore] = useState(0);

            const handleLoginSuccess = () => {
                setIsLoggedIn(true);
                setShowLoginModal(false);
            };

            const startGame = async (selectedTheme) => {
                setTheme(selectedTheme);
                setLoadingQuestions(true);
                const result = await fetchAllQuestionsFromGPT(selectedTheme);
                setLoadingQuestions(false);

                if (result.error) {
                    alert(result.error);
                } else {
                    setAllQuestions(result);
                    setScreen('menu');
                    setTotalScore(0);
                }
            };

            const selectLevel = (l) => { setLevel(l); setScore(0); setScreen('quiz'); };
            const finishQuiz = (s) => { setScore(s); setTotalScore(p => p + s); setScreen('result'); };
            const nextLevel = (l) => { setLevel(l); setScore(0); setScreen('quiz'); };
            const restart = () => { setTheme(''); setAllQuestions({ easy: [], medium: [], hard: [] }); setTotalScore(0); setScreen('start'); };
            const backToMenu = () => { setScreen('menu'); };

            useEffect(() => { if(window.lucide) window.lucide.createIcons(); }, [screen, showLoginModal]);

            return (
                <>
                    {/* Menu Hamburguer sﾃｳ visﾃｭvel na tela inicial */}
                    {screen === 'start' && (
                        <HamburgerMenu 
                            onLoginClick={() => setShowLoginModal(true)} 
                            isLoggedIn={isLoggedIn} 
                        />
                    )}

                    {/* Modal de Login (Sobreposto) */}
                    {showLoginModal && (
                        <LoginScreen 
                            onLoginSuccess={handleLoginSuccess} 
                            onCancel={() => setShowLoginModal(false)}
                        />
                    )}

                    {/* Telas Principais */}
                    {screen === 'start' && <StartScreen onStart={startGame} loading={loadingQuestions} />}
                    {screen === 'menu' && <MenuScreen theme={theme} onSelectLevel={selectLevel} onBack={restart} />}
                    {screen === 'quiz' && <QuizScreen theme={theme} level={level} questions={allQuestions[level]} onFinish={finishQuiz} onAbort={backToMenu} />}
                    {screen === 'result' && <ResultScreen score={score} totalScore={totalScore} level={level} onRestart={restart} onNextLevel={nextLevel} onMenu={backToMenu} />}
                </>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


