<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RetroQuiz 70s - Auth & Offline</title>
    
    <!-- BIBLIOTECAS -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;700&family=Shrikhand&display=swap" rel="stylesheet">

    <style>
        :root {
            --cor-laranja: #dc5128;
            --cor-verde: #a2cebb;
            --cor-creme: #fdfbf7;
            --cor-preto: #1a1a1a;
            --cor-amarelo: #f4d03f;
        }

        body {
            background-color: var(--cor-creme);
            background-image:  radial-gradient(rgba(220, 81, 40, 0.08) 2px, transparent 2px), radial-gradient(rgba(220, 81, 40, 0.08) 2px, transparent 2px);
            background-size: 30px 30px;
            background-position: 0 0, 15px 15px;
            font-family: 'DM Sans', sans-serif;
            color: var(--cor-preto);
            overflow-x: hidden;
            min-height: 100vh;
        }

        .font-retro { font-family: 'Shrikhand', cursive; letter-spacing: 1px; }

        .hard-shadow {
            box-shadow: 4px 4px 0px 0px var(--cor-preto);
            transition: all 0.2s ease;
            border: 3px solid var(--cor-preto);
        }
        
        .hard-shadow:active:not(:disabled) {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0px 0px var(--cor-preto);
        }
        
        .hard-shadow:disabled { opacity: 0.6; cursor: not-allowed; box-shadow: none; }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-slide-in { animation: slideIn 0.5s ease-out forwards; }

        /* Estilos espec√≠ficos para o Login */
        .login-input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 3px solid var(--cor-preto);
            border-radius: 8px;
            font-size: 1rem;
            outline: none;
        }
        .login-input:focus {
            border-color: var(--cor-laranja);
            background-color: #fff8f0;
        }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // =================================================================
        // üîë CONFIGURA√á√ÉO DA API & DADOS
        // =================================================================
        const PART_A = "sk-proj-Wuj2j8kDamPxvALe8xWXhvxMMwsWxUwftwzkmeL1ylnGzYPMdU1QYAO1B1Wpxyn"; 
        const PART_B = "QLrQfDGcIMOT3BlbkFJM5YNmkMRwdetW1loy5AYAhEfO6pQb0iJCbBJiTw0Wh3O5tQg-cAWmeu7VisSbjIQ6zu4HAsx4A"; 
        const API_KEY = PART_A + PART_B; 
        const MAX_IMAGES = 3; 

        // -----------------------------------------------------------------
        // üìö BANCO DE DADOS OFFLINE (Temas Pr√©-definidos)
        // -----------------------------------------------------------------
        const OFFLINE_DB = {
            "Cinema": {
                easy: [
                    { text: "Qual filme tem um ogro verde como protagonista?", options: ["Shrek", "Hulk", "Grinch", "Yoda"], answer: "Shrek", points: 10 },
                    { text: "Quem √© o vil√£o de Star Wars que usa armadura preta?", options: ["Darth Vader", "Voldemort", "Coringa", "Thanos"], answer: "Darth Vader", points: 10 },
                    { text: "Qual animal √© o Rei Le√£o?", options: ["Le√£o", "Tigre", "Urso", "Lobo"], answer: "Le√£o", points: 10 },
                    { text: "Em 'Titanic', o que causa o naufr√°gio?", options: ["Iceberg", "Baleia", "Torpedo", "Tempestade"], answer: "Iceberg", points: 10 },
                    { text: "Qual brinquedo ganha vida em Toy Story?", options: ["Todos os brinquedos", "Apenas o Woody", "Nenhum", "Bonecas apenas"], answer: "Todos os brinquedos", points: 10 }
                ],
                medium: [
                    { text: "Quem dirigiu 'Parque dos Dinossauros' (1993)?", options: ["Steven Spielberg", "George Lucas", "James Cameron", "Tarantino"], answer: "Steven Spielberg", points: 20 },
                    { text: "Qual a p√≠lula que Neo toma em Matrix?", options: ["Vermelha", "Azul", "Verde", "Amarela"], answer: "Vermelha", points: 20 },
                    { text: "Em 'O Senhor dos An√©is', quantos an√©is foram dados aos An√µes?", options: ["7", "3", "9", "1"], answer: "7", points: 20 },
                    { text: "Qual o nome da cidade fict√≠cia do Batman?", options: ["Gotham", "Metropolis", "Star City", "Smallville"], answer: "Gotham", points: 20 },
                    { text: "Quem interpretou o Coringa em 'O Cavaleiro das Trevas'?", options: ["Heath Ledger", "Joaquin Phoenix", "Jared Leto", "Jack Nicholson"], answer: "Heath Ledger", points: 20 }
                ],
                hard: [
                    { text: "Qual foi o primeiro filme a ganhar o Oscar de Melhor Filme?", options: ["Wings", "Sunrise", "Metropolis", "The Jazz Singer"], answer: "Wings", points: 30 },
                    { text: "Em 'Pulp Fiction', o que tem dentro da maleta?", options: ["Nunca √© revelado", "Ouro", "Diamantes", "A alma do Marsellus"], answer: "Nunca √© revelado", points: 30 },
                    { text: "Qual o nome do rob√¥ em 'Interstellar'?", options: ["TARS", "HAL", "R2-D2", "Ava"], answer: "TARS", points: 30 },
                    { text: "Quem comp√¥s a trilha sonora de 'O Bom, o Mau e o Feio'?", options: ["Ennio Morricone", "Hans Zimmer", "John Williams", "Vangelis"], answer: "Ennio Morricone", points: 30 },
                    { text: "Em que ano estreou 'O Poderoso Chef√£o'?", options: ["1972", "1974", "1969", "1970"], answer: "1972", points: 30 }
                ]
            },
            "Ci√™ncias": {
                easy: [
                    { text: "Qual planeta √© conhecido como Planeta Vermelho?", options: ["Marte", "J√∫piter", "V√™nus", "Saturno"], answer: "Marte", points: 10 },
                    { text: "O que as plantas usam para fazer fotoss√≠ntese?", options: ["Luz solar", "Fogo", "Vento", "Areia"], answer: "Luz solar", points: 10 },
                    { text: "Qual √© a f√≥rmula da √°gua?", options: ["H2O", "CO2", "O2", "H2SO4"], answer: "H2O", points: 10 },
                    { text: "Quantas pernas tem uma aranha?", options: ["8", "6", "4", "10"], answer: "8", points: 10 },
                    { text: "Qual √≥rg√£o bombeia sangue no corpo?", options: ["Cora√ß√£o", "F√≠gado", "Pulm√£o", "Est√¥mago"], answer: "Cora√ß√£o", points: 10 }
                ],
                medium: [
                    { text: "Qual √© o metal l√≠quido √† temperatura ambiente?", options: ["Merc√∫rio", "Ferro", "Chumbo", "Alum√≠nio"], answer: "Merc√∫rio", points: 20 },
                    { text: "Quem prop√¥s a Teoria da Relatividade?", options: ["Einstein", "Newton", "Tesla", "Darwin"], answer: "Einstein", points: 20 },
                    { text: "Qual o s√≠mbolo qu√≠mico do Ouro?", options: ["Au", "Ag", "Fe", "Cu"], answer: "Au", points: 20 },
                    { text: "Qual a velocidade da luz (aprox)?", options: ["300.000 km/s", "150.000 km/s", "1.000 km/s", "Som"], answer: "300.000 km/s", points: 20 },
                    { text: "O que √© o DNA?", options: ["√Åcido Desoxirribonucleico", "√Åcido Ribonucleico", "Prote√≠na", "Gordura"], answer: "√Åcido Desoxirribonucleico", points: 20 }
                ],
                hard: [
                    { text: "Qual part√≠cula √© conhecida como 'Part√≠cula de Deus'?", options: ["B√≥son de Higgs", "Quark", "Neutrino", "F√≥ton"], answer: "B√≥son de Higgs", points: 30 },
                    { text: "Quem descobriu a Penicilina?", options: ["Fleming", "Pasteur", "Curie", "Darwin"], answer: "Fleming", points: 30 },
                    { text: "Qual √© a estrela mais pr√≥xima da Terra depois do Sol?", options: ["Proxima Centauri", "Sirius", "Alpha Centauri A", "Betelgeuse"], answer: "Proxima Centauri", points: 30 },
                    { text: "O que mede a escala de Mohs?", options: ["Dureza dos minerais", "Terremotos", "Ventos", "Acidez"], answer: "Dureza dos minerais", points: 30 },
                    { text: "Qual o nome da primeira ovelha clonada?", options: ["Dolly", "Molly", "Polly", "Holly"], answer: "Dolly", points: 30 }
                ]
            }
        };

        // --- SERVI√áO DE API (MODIFICADO PARA PEGAR TUDO DE UMA VEZ) ---
        const fetchAllQuestionsFromGPT = async (theme) => {
            // Se for um tema Offline, retorna direto
            if (OFFLINE_DB[theme]) {
                console.log("Usando banco offline para:", theme);
                await new Promise(r => setTimeout(r, 1000)); // Fake loading
                return OFFLINE_DB[theme];
            }

            if (!API_KEY) return { error: "API Key n√£o configurada." };

            const prompt = `
                Topic: "${theme}".
                
                Generate a COMPLETE QUIZ with 15 UNIQUE multiple-choice questions divided into 3 levels:
                - 5 Easy questions (Basic definitions, famous facts)
                - 5 Medium questions (Specific details, relationships)
                - 5 Hard questions (Obscure trivia, technical dates/facts)
                
                Target Audience Language: Brazilian Portuguese (pt-BR).
                
                Strict Output Rules:
                1. Return ONLY a valid JSON object. No Markdown.
                2. Structure: { "easy": [...5 objects], "medium": [...5 objects], "hard": [...5 objects] }
                3. Each question object: { "text": "Question?", "options": ["A", "B", "C", "D"], "answer": "Correct Option String" }
                4. Ensure NO repeated questions across levels.
                5. Ensure 1 correct answer and 3 wrong answers per question.
            `;

            try {
                const response = await fetch("https://api.openai.com/v1/chat/completions", {
                    method: "POST",
                    headers: { "Content-Type": "application/json", "Authorization": `Bearer ${API_KEY}` },
                    body: JSON.stringify({
                        model: "gpt-4o",
                        messages: [{ role: "user", content: prompt }],
                        temperature: 0.7
                    })
                });

                const data = await response.json();
                if (data.error) return { error: "Erro na API: " + data.error.message };

                let content = data.choices[0].message.content.replace(/```json/g, '').replace(/```/g, '').trim();
                const parsed = JSON.parse(content);

                // Validar estrutura b√°sica
                if (!parsed.easy || !parsed.medium || !parsed.hard) {
                    return { error: "A IA n√£o retornou os 3 n√≠veis corretamente." };
                }

                // Adicionar pontos
                parsed.easy = parsed.easy.map(q => ({...q, points: 10}));
                parsed.medium = parsed.medium.map(q => ({...q, points: 20}));
                parsed.hard = parsed.hard.map(q => ({...q, points: 30}));

                return parsed;

            } catch (error) {
                console.error("Erro API:", error);
                return { error: "Falha na conex√£o. Tente um tema offline." };
            }
        };

        // --- COMPONENTES UI ---

        const Button = ({ children, onClick, variant = 'primary', className = '', disabled = false }) => {
            const colors = {
                primary: 'bg-[#dc5128] text-white',
                secondary: 'bg-[#a2cebb] text-black',
                yellow: 'bg-[#f4d03f] text-black',
                white: 'bg-white text-black',
                red: 'bg-red-500 text-white',
                outline: 'bg-transparent border-2 border-black hover:bg-black/5'
            };
            return (
                <button 
                    onClick={onClick} disabled={disabled}
                    className={`hard-shadow rounded-lg px-6 py-3 font-bold text-lg flex items-center justify-center gap-2 ${colors[variant]} ${className}`}
                >
                    {children}
                </button>
            );
        };

        const RetroImage = ({ src, className }) => {
            const [error, setError] = useState(false);
            if (error) return null; 
            return <img src={src} className={className} onError={() => setError(true)} />;
        };

        // --- TELA DE LOGIN ---
        const LoginScreen = ({ onLoginSuccess }) => {
            const [email, setEmail] = useState("");
            const [password, setPassword] = useState("");
            const [error, setError] = useState("");

            const handleLogin = () => {
                if (email === "rickalissonpaz@gmail.com" && password === "12345678") {
                    onLoginSuccess();
                } else {
                    setError("Credenciais inv√°lidas.");
                }
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-4">
                    <div className="bg-white hard-shadow p-8 rounded-2xl max-w-md w-full border-4 border-black relative">
                        <div className="text-center mb-6">
                            <h1 className="font-retro text-4xl text-[#dc5128]">RetroQuiz</h1>
                            <p className="font-bold text-gray-500">√Årea Restrita</p>
                        </div>
                        
                        <div className="space-y-4">
                            <div>
                                <label className="block font-bold mb-1">E-mail</label>
                                <input 
                                    type="email" 
                                    className="login-input" 
                                    placeholder="seu@email.com"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                />
                            </div>
                            <div>
                                <label className="block font-bold mb-1">Senha</label>
                                <input 
                                    type="password" 
                                    className="login-input" 
                                    placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                />
                            </div>
                            
                            {error && (
                                <div className="bg-red-100 border-2 border-red-500 text-red-700 p-3 rounded mb-4 font-bold text-sm">
                                    {error}
                                    <div className="mt-2 text-xs font-normal">
                                        N√£o tem acesso? Solicite via WhatsApp:<br/>
                                        <a href="https://wa.me/5511957970304" target="_blank" className="underline font-bold hover:text-red-900">(11) 95797-0304</a>
                                    </div>
                                </div>
                            )}

                            <Button onClick={handleLogin} className="w-full">Entrar</Button>
                        </div>
                    </div>
                    <div className="mt-8 text-center text-sm font-bold opacity-60">
                        <p>Acesso exclusivo para convidados.</p>
                    </div>
                </div>
            );
        };

        const StartScreen = ({ onStart, loading }) => {
            const [theme, setTheme] = useState("");
            
            // Temas pr√©-definidos (Offline e Online)
            const presets = ["Cinema", "Ci√™ncias", "Anos 80", "Hist√≥ria"];

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-4 relative animate-slide-in overflow-hidden">
                    <RetroImage src="assets/images/red/1.png" className="absolute left-4 top-1/4 w-32 md:w-48 hidden md:block opacity-80" />
                    <RetroImage src="assets/images/red/2.png" className="absolute right-4 bottom-1/4 w-32 md:w-48 hidden md:block opacity-80" />

                    <div className="text-center mb-10 w-full max-w-4xl relative z-10">
                        <img src="assets/images/RetroLogoOrange.PNG" alt="RetroQuiz" className="w-full max-w-3xl mx-auto mb-4" onError={(e) => {e.target.style.display='none'; document.getElementById('txt-logo').style.display='block'}} />
                        <h1 id="txt-logo" className="font-retro text-8xl md:text-9xl text-[#dc5128] hidden drop-shadow-[4px_4px_0_black]">RetroQuiz</h1>
                        <div className="bg-[#a2cebb] border-2 border-black inline-block px-4 py-2 text-xl -rotate-2 font-bold shadow-[3px_3px_0_0_black]">Edi√ß√£o Premium</div>
                    </div>

                    {loading ? (
                        <div className="bg-white p-10 rounded-2xl border-2 border-black hard-shadow flex flex-col items-center">
                            <div className="animate-spin rounded-full h-12 w-12 border-b-4 border-[#dc5128] mb-4"></div>
                            <h2 className="font-retro text-2xl text-[#dc5128]">Preparando Perguntas...</h2>
                            <p className="font-bold text-gray-500">Criando desafios √∫nicos para voc√™.</p>
                        </div>
                    ) : (
                        <div className="bg-white p-6 rounded-2xl border-2 border-black relative z-10 hard-shadow w-full max-w-lg">
                            <h2 className="text-2xl text-center mb-6 font-bold">Escolha um tema ou digite o seu:</h2>
                            
                            {/* Op√ß√µes Pr√©-definidas */}
                            <div className="grid grid-cols-2 gap-3 mb-6">
                                {presets.map(p => (
                                    <button 
                                        key={p} 
                                        onClick={() => onStart(p)}
                                        className={`font-bold py-2 border-2 border-black rounded-lg hover:bg-[#f4d03f] transition-colors ${OFFLINE_DB[p] ? 'bg-green-50' : 'bg-gray-50'}`}
                                    >
                                        {p} {OFFLINE_DB[p] && <span className="text-[10px] bg-green-200 px-1 rounded ml-1 border border-green-600">OFF</span>}
                                    </button>
                                ))}
                            </div>

                            <div className="relative flex items-center mb-2">
                                <div className="flex-grow border-t border-gray-300"></div>
                                <span className="flex-shrink-0 mx-4 text-gray-400 font-bold text-sm">OU DIGITE</span>
                                <div className="flex-grow border-t border-gray-300"></div>
                            </div>

                            <div className="flex w-full gap-2">
                                <input type="text" value={theme} onChange={(e) => setTheme(e.target.value)} onKeyPress={(e) => e.key === 'Enter' && theme.trim() && onStart(theme)} placeholder="Qualquer assunto..." className="flex-1 p-4 text-xl border-3 border-black rounded-xl outline-none focus:ring-4 ring-[#a2cebb]" />
                                <Button onClick={() => theme.trim() && onStart(theme)} disabled={!theme.trim()}><i data-lucide="arrow-right"></i></Button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const MenuScreen = ({ theme, onSelectLevel, onBack }) => (
            <div className="min-h-screen flex flex-col p-6 max-w-5xl mx-auto animate-slide-in">
                <button onClick={onBack} className="self-start flex items-center font-bold hover:underline mb-8 text-lg"><i data-lucide="arrow-left" className="mr-2"></i> Voltar</button>
                <div className="text-center mb-10">
                    <p className="text-gray-500 uppercase tracking-widest text-sm font-bold">Tema Escolhido</p>
                    <h1 className="font-retro text-5xl md:text-6xl text-[#dc5128]">{theme}</h1>
                </div>
                <div className="grid md:grid-cols-3 gap-6">
                    {[
                        { id: 'easy', title: 'F√°cil', color: 'bg-[#a2cebb]', desc: 'Aquecimento' },
                        { id: 'medium', title: 'M√©dio', color: 'bg-[#f4d03f]', desc: 'O Desafio' },
                        { id: 'hard', title: 'Dif√≠cil', color: 'bg-[#dc5128] text-white', desc: 'Expert' }
                    ].map(lvl => (
                        <div key={lvl.id} onClick={() => onSelectLevel(lvl.id)} className={`${lvl.color} p-8 rounded-xl hard-shadow cursor-pointer hover:-translate-y-2 transition-all flex flex-col justify-between min-h-[200px]`}>
                            <div><h2 className="font-retro text-3xl mb-2">{lvl.title}</h2><p className="font-bold text-lg opacity-90">{lvl.desc}</p></div>
                            <div className="self-end mt-4"><i data-lucide="play-circle" size={40}></i></div>
                        </div>
                    ))}
                </div>
            </div>
        );

        const QuizScreen = ({ theme, level, questions, onFinish, onAbort }) => {
            const [currentIndex, setCurrentIndex] = useState(0);
            const [score, setScore] = useState(0);
            const [selectedOption, setSelectedOption] = useState(null);
            const [isConfirmed, setIsConfirmed] = useState(false);
            
            const decoration = useMemo(() => {
                const r1 = Math.floor(Math.random() * MAX_IMAGES) + 1;
                let r2 = Math.floor(Math.random() * MAX_IMAGES) + 1;
                if (r1 === r2) r2 = (r1 % MAX_IMAGES) + 1;
                return { left: `assets/${level}/${r1}.png`, right: `assets/${level}/${r2}.png` };
            }, [level]);

            const handleConfirm = () => {
                setIsConfirmed(true);
                const currentQ = questions[currentIndex];
                const correct = currentQ.answer === selectedOption;
                
                if (correct) {
                    setScore(s => s + currentQ.points);
                    confetti({ particleCount: 30, spread: 50, origin: { y: 0.8 } });
                }

                setTimeout(() => {
                    if (currentIndex < questions.length - 1) {
                        setCurrentIndex(p => p + 1);
                        setSelectedOption(null);
                        setIsConfirmed(false);
                    } else {
                        onFinish(correct ? score + currentQ.points : score, level);
                    }
                }, 1500);
            };

            const currentQ = questions[currentIndex];
            const progress = ((currentIndex) / questions.length) * 100;

            return (
                <div className="min-h-screen flex flex-col relative overflow-hidden animate-slide-in">
                    <RetroImage src={decoration.left} className="absolute left-4 bottom-4 w-32 md:w-40 opacity-70 pointer-events-none hidden md:block" />
                    <RetroImage src={decoration.right} className="absolute right-4 top-20 w-32 md:w-40 opacity-70 pointer-events-none hidden md:block" />

                    <div className="p-4 flex justify-between items-center bg-white border-b-4 border-black z-10">
                        <div className="flex items-center gap-4">
                            <button onClick={onAbort} className="bg-red-100 hover:bg-red-200 p-2 rounded-lg border-2 border-black transition-colors" title="Sair para Menu">
                                <i data-lucide="x" className="text-red-600"></i>
                            </button>
                            <span className="font-bold text-lg">Quest√£o {currentIndex + 1}/{questions.length}</span>
                        </div>
                        <span className="font-retro text-2xl text-[#dc5128]">{score} pts</span>
                    </div>

                    <div className="h-4 bg-gray-200 w-full border-b-4 border-black">
                        <div className="h-full bg-[#a2cebb] transition-all duration-500 ease-out" style={{ width: `${progress}%` }}></div>
                    </div>

                    <div className="flex-1 flex flex-col items-center justify-center p-6 max-w-3xl mx-auto w-full z-10">
                        <div className="bg-white border-4 border-black p-8 rounded-xl w-full mb-6 text-center hard-shadow">
                            <h2 className="text-2xl font-bold leading-tight">{currentQ.text}</h2>
                        </div>
                        <div className="grid gap-3 w-full">
                            {currentQ.options.map((opt, idx) => {
                                let btnStyle = "bg-white hover:bg-gray-100";
                                if (isConfirmed) {
                                    if (opt === currentQ.answer) btnStyle = "bg-[#a2cebb] ring-4 ring-black"; 
                                    else if (opt === selectedOption) btnStyle = "bg-[#dc5128] text-white";
                                } else if (selectedOption === opt) {
                                    btnStyle = "bg-[#f4d03f] ring-4 ring-black";
                                }
                                return (
                                    <button key={idx} onClick={() => !isConfirmed && setSelectedOption(opt)} disabled={isConfirmed} className={`w-full p-4 text-lg font-bold border-3 border-black rounded-lg text-left transition-all flex items-center ${btnStyle}`}>
                                        <span className="w-8 h-8 flex items-center justify-center bg-gray-100 border-2 border-black rounded-full mr-3 text-sm flex-shrink-0">{String.fromCharCode(65 + idx)}</span>
                                        {opt}
                                    </button>
                                );
                            })}
                        </div>
                        <div className="mt-8 w-full md:w-auto">
                            <Button onClick={handleConfirm} disabled={!selectedOption || isConfirmed} className="w-full md:min-w-[200px]">
                                {isConfirmed ? "Verificando..." : "Confirmar"}
                            </Button>
                        </div>
                    </div>
                </div>
            );
        };

        const ResultScreen = ({ score, level, totalScore, onRestart, onNextLevel, onMenu }) => {
            const passed = score >= 30; // 30 points to pass
            const nextLevelId = (level === 'easy') ? 'medium' : (level === 'medium' ? 'hard' : null);

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-4 text-center animate-slide-in">
                    <div className="bg-white hard-shadow p-8 rounded-2xl max-w-lg w-full relative border-4 border-black">
                        <h2 className="text-gray-500 uppercase tracking-widest font-bold mb-2 text-sm">Resultado: {level}</h2>
                        <h1 className="font-retro text-6xl text-[#dc5128] mb-4">{score >= 30 ? "Mandou Bem!" : "Tente de novo"}</h1>
                        <div className="bg-[#fdfbf7] border-3 border-black p-6 rounded-xl mb-6 inline-block w-full">
                            <p className="text-sm font-bold uppercase text-gray-500 mb-2">Pontos da Fase</p>
                            <p className="font-retro text-7xl text-[#1a1a1a] leading-none">{score}</p>
                            <p className="text-lg font-bold mt-2 text-gray-600">Total Acumulado: {totalScore}</p>
                        </div>
                        <div className="flex flex-col gap-3">
                            {passed && nextLevelId && (
                                <Button onClick={() => onNextLevel(nextLevelId)} variant="secondary" className="w-full">
                                    Jogar Pr√≥ximo N√≠vel <i data-lucide="arrow-right"></i>
                                </Button>
                            )}
                            <Button onClick={onMenu} variant="white" className="w-full">
                                <i data-lucide="list"></i> Voltar ao Menu de N√≠veis
                            </Button>
                            <Button onClick={onRestart} variant="white" className="w-full text-sm">
                                <i data-lucide="rotate-ccw"></i> Escolher Outro Tema
                            </Button>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [screen, setScreen] = useState('login'); // Start at Login
            const [theme, setTheme] = useState('');
            const [loadingQuestions, setLoadingQuestions] = useState(false);
            
            // Estado Global de Perguntas para o Tema Atual
            const [allQuestions, setAllQuestions] = useState({ easy: [], medium: [], hard: [] });

            const [level, setLevel] = useState('easy');
            const [score, setScore] = useState(0);
            const [totalScore, setTotalScore] = useState(0);

            // Fluxo de Auth
            const handleLoginSuccess = () => {
                setIsAuthenticated(true);
                setScreen('start');
            };

            // Fluxo do Jogo
            const startGame = async (selectedTheme) => {
                setTheme(selectedTheme);
                setLoadingQuestions(true);
                
                // Fetch all 15 questions
                const result = await fetchAllQuestionsFromGPT(selectedTheme);
                
                setLoadingQuestions(false);

                if (result.error) {
                    alert(result.error);
                } else {
                    setAllQuestions(result);
                    setScreen('menu');
                    setTotalScore(0);
                }
            };

            const selectLevel = (l) => { 
                setLevel(l); 
                setScore(0); 
                setScreen('quiz'); 
            };

            const finishQuiz = (s, currentLevel) => { 
                setScore(s); 
                setTotalScore(p => p + s); 
                setScreen('result'); 
            };

            const nextLevel = (nextLvlId) => { 
                setLevel(nextLvlId); 
                setScore(0); 
                setScreen('quiz'); 
            };

            const restart = () => { 
                setTheme(''); 
                setAllQuestions({ easy: [], medium: [], hard: [] });
                setTotalScore(0); 
                setScreen('start'); 
            };

            const backToMenu = () => { setScreen('menu'); };

            useEffect(() => { if(window.lucide) window.lucide.createIcons(); }, [screen]);

            if (!isAuthenticated) {
                return <LoginScreen onLoginSuccess={handleLoginSuccess} />;
            }

            return (
                <>
                    {screen === 'start' && <StartScreen onStart={startGame} loading={loadingQuestions} />}
                    {screen === 'menu' && <MenuScreen theme={theme} onSelectLevel={selectLevel} onBack={restart} />}
                    {screen === 'quiz' && <QuizScreen theme={theme} level={level} questions={allQuestions[level]} onFinish={finishQuiz} onAbort={backToMenu} />}
                    {screen === 'result' && <ResultScreen score={score} totalScore={totalScore} level={level} onRestart={restart} onNextLevel={nextLevel} onMenu={backToMenu} />}
                </>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
